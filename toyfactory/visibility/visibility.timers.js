;(function(window){"use strict";var lastTimer=-1;var install=function(Visibility){Visibility.every=function(interval,hiddenInterval,callback){Visibility._time();if(!callback){callback=hiddenInterval;hiddenInterval=null;}
lastTimer+=1;var number=lastTimer;Visibility._timers[number]={visible:interval,hidden:hiddenInterval,callback:callback};Visibility._run(number,false);if(Visibility.isSupported()){Visibility._listen();}
return number;};Visibility.stop=function(id){if(!Visibility._timers[id]){return false;}
Visibility._stop(id);delete Visibility._timers[id];return true;};Visibility._timers={};Visibility._time=function(){if(Visibility._timed){return;}
Visibility._timed=true;Visibility._wasHidden=Visibility.hidden();Visibility.change(function(){Visibility._stopRun();Visibility._wasHidden=Visibility.hidden();});};Visibility._run=function(id,runNow){var interval,timer=Visibility._timers[id];if(Visibility.hidden()){if(null===timer.hidden){return;}
interval=timer.hidden;}else{interval=timer.visible;}
var runner=function(){timer.last=new Date();timer.callback.call(window);}
if(runNow){var now=new Date();var last=now-timer.last;if(interval>last){timer.delay=setTimeout(function(){runner();timer.id=setInterval(runner,interval);},interval-last);}else{runner();timer.id=setInterval(runner,interval);}}else{timer.id=setInterval(runner,interval);}};Visibility._stop=function(id){var timer=Visibility._timers[id];clearInterval(timer.id);clearTimeout(timer.delay);delete timer.id;delete timer.delay;};Visibility._stopRun=function(event){var isHidden=Visibility.hidden(),wasHidden=Visibility._wasHidden;if((isHidden&&!wasHidden)||(!isHidden&&wasHidden)){for(var i in Visibility._timers){Visibility._stop(i);Visibility._run(i,!isHidden);}}};return Visibility;}
if(typeof(module)!='undefined'&&module.exports){module.exports=install(require('./visibility.core'));}else{install(window.Visibility)}})(window);