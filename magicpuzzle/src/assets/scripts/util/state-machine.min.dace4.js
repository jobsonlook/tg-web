!function(){var v={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,e){var n="string"==typeof t.initial?{state:t.initial}:t.initial,r=t.terminal||t.final,i=e||t.target||{},a=t.events||[],o=t.callbacks||{},u={},s={},c=function(t){var e=Array.isArray(t.from)?t.from:t.from?[t.from]:[v.WILDCARD];u[t.name]=u[t.name]||{};for(var n=0;n<e.length;n++)s[e[n]]=s[e[n]]||[],s[e[n]].push(t.name),u[t.name][e[n]]=t.to||e[n];t.to&&(s[t.to]=s[t.to]||[])};n&&(n.event=n.event||"startup",c({name:n.event,from:"none",to:n.state}));for(var f=0;f<a.length;f++)c(a[f]);for(var l in u)u.hasOwnProperty(l)&&(i[l]=v.buildEvent(l,u[l]));for(var l in o)o.hasOwnProperty(l)&&(i[l]=o[l]);return i.current="none",i.is=function(t){return Array.isArray(t)?0<=t.indexOf(this.current):this.current===t},i.can=function(t){return!this.transition&&void 0!==u[t]&&(u[t].hasOwnProperty(this.current)||u[t].hasOwnProperty(v.WILDCARD))},i.cannot=function(t){return!this.can(t)},i.transitions=function(){return(s[this.current]||[]).concat(s[v.WILDCARD]||[])},i.isFinished=function(){return this.is(r)},i.error=t.error||function(t,e,n,r,i,a,o){throw o||a},i.states=function(){return Object.keys(s).sort()},n&&!n.defer&&i[n.event](),i},doCallback:function(t,e,n,r,i,a){if(e)try{return e.apply(t,[n,r,i].concat(a))}catch(e){return t.error(n,r,i,a,v.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(t,e,n,r,i){return v.doCallback(t,t.onbeforeevent,e,n,r,i)},afterAnyEvent:function(t,e,n,r,i){return v.doCallback(t,t.onafterevent||t.onevent,e,n,r,i)},leaveAnyState:function(t,e,n,r,i){return v.doCallback(t,t.onleavestate,e,n,r,i)},enterAnyState:function(t,e,n,r,i){return v.doCallback(t,t.onenterstate||t.onstate,e,n,r,i)},changeState:function(t,e,n,r,i){return v.doCallback(t,t.onchangestate,e,n,r,i)},beforeThisEvent:function(t,e,n,r,i){return v.doCallback(t,t["onbefore"+e],e,n,r,i)},afterThisEvent:function(t,e,n,r,i){return v.doCallback(t,t["onafter"+e]||t["on"+e],e,n,r,i)},leaveThisState:function(t,e,n,r,i){return v.doCallback(t,t["onleave"+n],e,n,r,i)},enterThisState:function(t,e,n,r,i){return v.doCallback(t,t["onenter"+r]||t["on"+r],e,n,r,i)},beforeEvent:function(t,e,n,r,i){if(!1===v.beforeThisEvent(t,e,n,r,i)||!1===v.beforeAnyEvent(t,e,n,r,i))return!1},afterEvent:function(t,e,n,r,i){v.afterThisEvent(t,e,n,r,i),v.afterAnyEvent(t,e,n,r,i)},leaveState:function(t,e,n,r,i){var a=v.leaveThisState(t,e,n,r,i),o=v.leaveAnyState(t,e,n,r,i);return!1!==a&&!1!==o&&(v.ASYNC===a||v.ASYNC===o?v.ASYNC:void 0)},enterState:function(t,e,n,r,i){v.enterThisState(t,e,n,r,i),v.enterAnyState(t,e,n,r,i)},buildEvent:function(a,o){return function(){var t=this.current,e=o[t]||(o[v.WILDCARD]!=v.WILDCARD?o[v.WILDCARD]:t)||t,n=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,t,e,n,v.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,t,e,n,v.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===v.beforeEvent(this,a,t,e,n))return v.Result.CANCELLED;if(t===e)return v.afterEvent(this,a,t,e,n),v.Result.NOTRANSITION;var r=this;this.transition=function(){return r.transition=null,r.current=e,v.enterState(r,a,t,e,n),v.changeState(r,a,t,e,n),v.afterEvent(r,a,t,e,n),v.Result.SUCCEEDED},this.transition.cancel=function(){r.transition=null,v.afterEvent(r,a,t,e,n)};var i=v.leaveState(this,a,t,e,n);return!1===i?(this.transition=null,v.Result.CANCELLED):v.ASYNC===i?v.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=v),exports.StateMachine=v):"function"==typeof define&&define.amd?define(function(t){return v}):"undefined"!=typeof window?window.StateMachine=v:"undefined"!=typeof self&&(self.StateMachine=v)}();